id: map-style
language: typescript
platform: node
type: library

tasks:
  validate:
    command: gl-style-validate
    args:
      - src/style.json
    inputs:
      - src/style.json
    options:
      cache: true

  diff:
    command: sh
    args:
      - -c
      - diff <(gl-style-format src/style.json) src/style.json
    inputs:
      - src/style.json
    options:
      cache: true

  format:
    command: sh
    args:
      - -c
      - gl-style-format src/style.json > /tmp/style.json && mv /tmp/style.json src/style.json
    inputs:
      - src/style.json
    outputs:
      - src/style.json
    options:
      cache: true

  build_sprites:
    command: sh
    args:
      - -c
      - ./build_sprites.sh
    inputs:
      - src/svgs
    outputs:
      - dist/sprites
    options:
      cache: true

  build:
    deps:
      - validate
      - build_sprites
    command: sh
    args:
      - -c
      - cp src/style.json dist/style.json && cp src/iconset.json dist/iconset.json
    inputs:
      - src/style.json
      - src/iconset.json
    outputs:
      - dist/style.json
      - dist/iconset.json
    options:
      cache: true

  dev:
    command: nodemon
    args:
      - -w
      - src
      - --exec
      - moon map-style:format && moon map-style:build
    options:
      cache: false
