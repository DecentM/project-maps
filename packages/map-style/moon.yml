id: map-style
language: typescript
platform: node
type: library

tasks:
  validate:
    command: gl-style-validate
    args:
      - src/style/*.json
    inputs:
      - src/style
    options:
      cache: true

  format:
    command: sh
    args:
      - -c
      - gl-style-format src/style/light.json > /tmp/style.json && mv /tmp/style.json src/style/light.json
    inputs:
      - src/style
    outputs:
      - src/style
    options:
      cache: true

  build_sprites:
    command: sh
    args:
      - -c
      - ./build_sprites.sh
    inputs:
      - src/svgs
    outputs:
      - dist/sprites
    options:
      cache: true

  build:
    deps:
      - validate
      - build_sprites
    command: sh
    args:
      - -c
      - cp -a src/style dist/ && cp src/iconset.json dist/iconset.json
    inputs:
      - src/style
      - src/iconset.json
    outputs:
      - dist/style
      - dist/iconset.json
    options:
      cache: true

  dev:
    command: nodemon
    args:
      - -w
      - src
      - --exec
      - moon map-style:build
    options:
      cache: false
